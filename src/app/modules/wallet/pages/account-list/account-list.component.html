<div class="m-sm-30">
  <app-breadcrumb></app-breadcrumb>
  <div class="mb-8">
    <div class="text-2xl mb-2 text-white leading-snug">
      Your Validator Accounts List
    </div>
    <p class="m-0 text-muted text-base leading-snug">
      Full list of all validating public keys managed by your Prysm wallet
    </p>
  </div>
  <div class="relative flex justify-start flex-wrap items-center md:justify-between mb-4">
    <mat-form-field class="search-bar text-base" appearance="fill">
      <mat-label>Search by public key, validator index, or account name</mat-label>
      <input
        matInput
        placeholder="0x004a19ce..."
        color="primary"
        (keyup)="applySearchFilter($event)">
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>
    <div class="flex items-center">
      <button mat-raised-button color="accent" class="large-btn">
        <span class="flex items-center">
          <span class="mr-2">Import</span>
          <mat-icon>cloud_upload</mat-icon>
        </span>
      </button>
      <div class="mx-2"></div>
      <button mat-raised-button color="primary" class="large-btn">
        <span class="flex items-center">
          <span class="mr-2">New Account</span>
          <mat-icon>add</mat-icon>
        </span>
      </button>
    </div>
  </div>

  <div class="account-selections mb-6" *ngIf="selection?.selected.length">
    <div class="text-muted text-lg">
      Selected {{selection?.selected.length}} Accounts
    </div>
    <div class="my-6">
      <mat-chip-list>
        <mat-chip *ngFor="let account of selection?.selected">
          {{account.publicKey | base64tohex | slice:0:16}}...
        </mat-chip>
      </mat-chip-list>
    </div>
    <div class="flex">
      <button mat-stroked-button color="primary">
        <span class="flex items-center">
          <span class="mr-2">View in Block Explorer</span>
          <mat-icon>open_in_new</mat-icon>
        </span>
      </button>
      <div class="mx-2"></div>
      <button mat-stroked-button color="accent">
        <span class="flex items-center">
          <span class="mr-2">Backup All</span>
          <mat-icon>get_app</mat-icon>
        </span>
      </button>
      <div class="mx-2"></div>
      <button mat-stroked-button color="warn">
        <span class="flex items-center">
          <span class="mr-2">Delete All</span>
          <mat-icon>delete_forever</mat-icon>
        </span>
      </button>
    </div>
  </div>

  <div class="mat-elevation-z8 relative">
    <div class="table-loading-shade" *ngIf="loading">
      <mat-spinner></mat-spinner>
    </div>

    <div class="table-container bg-paper">
      <table mat-table [dataSource]="dataSource" matSort>
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>
            <mat-checkbox (change)="$event ? masterToggle() : null"
                          [checked]="selection?.hasValue() && isAllSelected()"
                          [indeterminate]="selection?.hasValue() && !isAllSelected()">
            </mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let row">
            <mat-checkbox (click)="$event.stopPropagation()"
                          (change)="$event ? selection?.toggle(row) : null"
                          [checked]="selection?.isSelected(row)">
            </mat-checkbox>
          </td>
        </ng-container>

        <ng-container matColumnDef="accountName">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Account Name </th>
          <td mat-cell *matCellDef="let row"> {{row.accountName}} </td>
        </ng-container>

        <ng-container matColumnDef="publicKey">
          <th mat-header-cell *matHeaderCellDef> Validating Public Key </th>
          <td mat-cell *matCellDef="let row"> {{row.publicKey | base64tohex | slice:0:12}}... </td>
        </ng-container>

        <ng-container matColumnDef="index">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Validator Index</th>
          <td mat-cell *matCellDef="let row"> {{row.index}} </td>
        </ng-container>

        <ng-container matColumnDef="balance">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ETH Balance</th>
          <td mat-cell *matCellDef="let row">
            <span [class.text-error]="row.lowBalance" [class.text-success]="!row.lowBalance">
              {{row.balance}}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="effectiveBalance">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> ETH Effective Balance</th>
          <td mat-cell *matCellDef="let row">
            <span [class.text-error]="row.lowBalance" [class.text-success]="!row.lowBalance">
              {{row.effectiveBalance}}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Status</th>
          <td mat-cell *matCellDef="let row">
            <mat-chip-list aria-label="Validator status">
              <mat-chip [color]="formatStatusColor(row.status)" selected>{{row.status}}</mat-chip>
            </mat-chip-list>
          </td>
        </ng-container>

        <ng-container matColumnDef="activationEpoch">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Activation Epoch</th>
          <td mat-cell *matCellDef="let row"> {{row.activationEpoch}} </td>
        </ng-container>

        <ng-container matColumnDef="exitEpoch">
          <th mat-header-cell *matHeaderCellDef mat-sort-header> Exit Epoch</th>
          <td mat-cell *matCellDef="let row"> {{row.exitEpoch}} </td>
        </ng-container>

        <ng-container matColumnDef="options">
          <th mat-header-cell *matHeaderCellDef>
            Actions
          </th>
          <td mat-cell *matCellDef="let row">
            <app-icon-trigger-select
              [groups]="optionGroups"
              icon="more_horiz"></app-icon-trigger-select>
          </td>
        </ng-container>


        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="4">No data matching the filter</td>
        </tr>
      </table>
    </div>

    <mat-paginator 
      (page)="handlePageEvent($event)" 
      [length]="totalData"
      [pageSizeOptions]="pageSizes">
    </mat-paginator>
  </div>
</div>
